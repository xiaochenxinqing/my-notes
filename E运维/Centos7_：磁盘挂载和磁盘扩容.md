# Centos7 ï¼šç£ç›˜æŒ‚è½½å’Œç£ç›˜æ‰©å®¹

https://zhuanlan.zhihu.com/p/621775504

**================================================ç£ç›˜æŒ‚è½½===============================================**

# ä¸€ã€æ€»ä½“ç›®æ ‡ï¼ˆä½ è¦åšçš„äº‹ï¼‰

> æ–°åŠ äº†ä¸€å—ç£ç›˜ï¼Œä¾‹å¦‚ `/dev/sdb`
>  æƒ³æŠŠå®ƒæ˜ å°„åˆ°ä¸€ä¸ªæ–°è·¯å¾„ï¼Œæ¯”å¦‚ `/data`

æœ€ç»ˆæ•ˆæœæ˜¯ï¼š

```
/dev/sdb1  â†’  /data
```

å¹¶ä¸” **é‡å¯ä¸ä¸¢å¤±æŒ‚è½½**

------

# äºŒã€ç¡®è®¤ç³»ç»Ÿå·²ç»è¯†åˆ«åˆ°æ–°ç£ç›˜ï¼ˆéå¸¸å…³é”®ï¼‰

### 1ï¸âƒ£ æŸ¥çœ‹ç£ç›˜åˆ—è¡¨

```
lsblk
```

å¸¸è§è¾“å‡ºç¤ºä¾‹ï¼š

```
NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sda      8:0    0    40G  0 disk
â”œâ”€sda1   8:1    0     1G  0 part /boot
â””â”€sda2   8:2    0    39G  0 part /
sdb      8:16   0   100G  0 disk
```

âœ” è¯´æ˜ï¼š

- `sdb` æ˜¯**æ–°ç›˜**
- æ²¡æœ‰ `part`ï¼Œè¯´æ˜è¿˜æ²¡åˆ†åŒº

å¦‚æœä½  **æ²¡çœ‹åˆ°æ–°ç›˜**ï¼š

```
dmesg | tail -50
```

æˆ–ï¼ˆSCSI æ‰«æï¼‰ï¼š

```
echo "- - -" > /sys/class/scsi_host/host0/scan
```

------

# ä¸‰ã€å¯¹æ–°ç£ç›˜è¿›è¡Œåˆ†åŒºï¼ˆæ¨è GPTï¼‰

> âš ï¸ åƒä¸‡ç¡®è®¤æ˜¯ **æ–°ç›˜**ï¼Œä¸è¦åŠ¨ç³»ç»Ÿç›˜ `/dev/sda`

### 2ï¸âƒ£ ä½¿ç”¨ `fdisk` æˆ– `parted`

#### æ–¹æ¡ˆ Aï¼šfdiskï¼ˆç®€å•ã€å¸¸ç”¨ï¼‰

```
fdisk /dev/sdb
```

äº¤äº’è¿‡ç¨‹ï¼š

```
n     # æ–°å»ºåˆ†åŒº
p     # ä¸»åˆ†åŒº
1     # åˆ†åŒºå·
å›è½¦  # èµ·å§‹æ‰‡åŒºï¼ˆé»˜è®¤ï¼‰
å›è½¦  # ç»“æŸæ‰‡åŒºï¼ˆç”¨æ»¡ç£ç›˜ï¼‰
w     # å†™å…¥å¹¶é€€å‡º
```

å®ŒæˆåéªŒè¯ï¼š

```
lsblk
```

çœ‹åˆ°ï¼š

```
sdb
â””â”€sdb1
```

------

### æ–¹æ¡ˆ Bï¼špartedï¼ˆé€‚åˆ >2T ç£ç›˜ï¼‰

```
parted /dev/sdb
mklabel gpt
mkpart primary ext4 0% 100%
quit
```

------

# å››ã€æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿï¼ˆext4 æœ€é€šç”¨ï¼‰

### 3ï¸âƒ£ åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ

```
mkfs.ext4 /dev/sdb1
```

å¦‚æœä½ æ˜¯æ•°æ®åº“ / å¤§æ–‡ä»¶åœºæ™¯ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ï¼š

- `xfs`ï¼ˆæœåŠ¡å™¨å¸¸ç”¨ï¼‰

```
mkfs.xfs /dev/sdb1
```

------

# äº”ã€åˆ›å»ºæŒ‚è½½ç›®å½•ï¼ˆä½ è¯´çš„â€œæ–°è·¯å¾„â€ï¼‰

### 4ï¸âƒ£ åˆ›å»ºè·¯å¾„

```
mkdir -p /data
```

ğŸ“Œ åŸåˆ™ï¼š

- ä¸è¦ç›´æ¥æŒ‚åˆ° `/`ã€`/usr`ã€`/etc`
- è‡ªå®šä¹‰æ•°æ®ç›˜ä¸€èˆ¬ç”¨ï¼š
  - `/data`
  - `/mnt/data`
  - `/opt/data`

------

# å…­ã€æ‰‹åŠ¨æŒ‚è½½æµ‹è¯•ï¼ˆå¼ºçƒˆå»ºè®®å…ˆåšï¼‰

### 5ï¸âƒ£ æ‰‹åŠ¨ mount

```
mount /dev/sdb1 /data
```

éªŒè¯ï¼š

```
df -h
```

è¾“å‡ºä¸­åº”çœ‹åˆ°ï¼š

```
/dev/sdb1   100G   1G   99G  1% /data
```

âœ” è¯´æ˜æŒ‚è½½æˆåŠŸ

------

# ä¸ƒã€è®¾ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…åšï¼‰

## â­ å¼ºçƒˆæ¨èï¼šä½¿ç”¨ UUIDï¼Œè€Œä¸æ˜¯ /dev/sdb1

### 6ï¸âƒ£ è·å– UUID

```
blkid /dev/sdb1
```

ç¤ºä¾‹è¾“å‡ºï¼š

```
/dev/sdb1: UUID="c1a2b3c4-d5e6-7890-abcd-1234567890ef" TYPE="ext4"
```

------

### 7ï¸âƒ£ ç¼–è¾‘ `/etc/fstab`

```
vim /etc/fstab
```

æ·»åŠ ä¸€è¡Œï¼š

```
UUID=c1a2b3c4-d5e6-7890-abcd-1234567890ef  /data  ext4  defaults  0  0
```

ğŸ“Œ å­—æ®µè§£é‡Šï¼š

```
è®¾å¤‡        æŒ‚è½½ç‚¹   æ–‡ä»¶ç³»ç»Ÿ  å‚æ•°        dump fsck
```

------

### 8ï¸âƒ£ éªŒè¯ fstab æ˜¯å¦å†™å¯¹ï¼ˆéå¸¸é‡è¦ï¼‰

```
mount -a
```

å¦‚æœ **æ²¡æŠ¥é”™**ï¼Œè¯´æ˜æ²¡é—®é¢˜
 å¦‚æœæŠ¥é”™ï¼Œ**ç«‹åˆ»ä¿®**ï¼Œå¦åˆ™ä¸‹æ¬¡é‡å¯å¯èƒ½è¿›æ•‘æ´æ¨¡å¼

------

# å…«ã€æƒé™ä¸å±ä¸»ï¼ˆç»å¸¸è¢«å¿½ç•¥ï¼‰

### 9ï¸âƒ£ æ ¹æ®ç”¨é€”è®¾ç½®æƒé™

```
chown -R appuser:appuser /data
chmod 755 /data
```

æˆ–è€…ç»™æœåŠ¡ç”¨ï¼š

```
chmod 750 /data
```

------

# ä¹ã€æœ€ç»ˆçŠ¶æ€æ£€æŸ¥æ¸…å•

```
lsblk
df -h
mount | grep /data
```

ä½ åº”è¯¥çœ‹åˆ°ï¼š

- `/dev/sdb1` å·²æŒ‚è½½åˆ° `/data`
- é‡å¯åä»ç„¶å­˜åœ¨













**================================================ç£ç›˜æ‰©å®¹===============================================**







`[root@localhost ~]# fdisk -l`

`ç£ç›˜ /dev/sdaï¼š236.2 GB, 236223201280 å­—èŠ‚ï¼Œ461373440 ä¸ªæ‰‡åŒº`
`Units = æ‰‡åŒº of 1 * 512 = 512 bytes`
`æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚`
`I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚`
`ç£ç›˜æ ‡ç­¾ç±»å‹ï¼šdos`
`ç£ç›˜æ ‡è¯†ç¬¦ï¼š0x000c85ed`

   `è®¾å¤‡ Boot      Start         End      Blocks   Id  System`
`/dev/sda1   *        2048     2099199     1048576   83  Linux`
`/dev/sda2         2099200    75497471    36699136   8e  Linux LVM`

`ç£ç›˜ /dev/mapper/centos-rootï¼š34.4 GB, 34351349760 å­—èŠ‚ï¼Œ67092480 ä¸ªæ‰‡åŒº`
`Units = æ‰‡åŒº of 1 * 512 = 512 bytes`
`æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚`
`I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚`


`ç£ç›˜ /dev/mapper/centos-swapï¼š3221 MB, 3221225472 å­—èŠ‚ï¼Œ6291456 ä¸ªæ‰‡åŒº`
`Units = æ‰‡åŒº of 1 * 512 = 512 bytes`
`æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚`
`I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚`

`[root@localhost ~]# df -h`
`æ–‡ä»¶ç³»ç»Ÿ                 å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹`
`/dev/mapper/centos-root   32G   12G   21G   36% /`
`devtmpfs                 3.9G     0  3.9G    0% /dev`
`tmpfs                    3.9G     0  3.9G    0% /dev/shm`
`tmpfs                    3.9G  9.6M  3.9G    1% /run`
`tmpfs                    3.9G     0  3.9G    0% /sys/fs/cgroup`
`/dev/sda1               1014M  166M  849M   17% /boot`
`tmpfs                    785M   12K  785M    1% /run/user/42`
`overlay                   32G   12G   21G   36% /var/lib/docker/overlay2/986f7de0dd02d6bfab8b18524f4a70f66d2c57a0ae8bdcd1bdb26974a7694c34/merged`
`tmpfs                    785M     0  785M    0% /run/user`





æ ¹æ®æ‚¨çš„ç³»ç»Ÿä¿¡æ¯ï¼Œæ‚¨çš„æ ¹åˆ†åŒº `/dev/mapper/centos-root` å½“å‰ä»…ä½¿ç”¨äº† 32G ç©ºé—´ï¼Œè€Œç£ç›˜ `/dev/sda` æ€»å®¹é‡ä¸º 236GBï¼Œå‰©ä½™çº¦ 200GB æœªåˆ†é…ã€‚æ‚¨éœ€è¦é€šè¿‡ LVM è¿›è¡Œæ‰©å®¹ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†æ­¥éª¤ï¼š

------

**æ€»ç»“æ­¥éª¤åº”ä¸ºï¼š**

1. ä½¿ç”¨partedè°ƒæ•´sda2åˆ†åŒºï¼Œè¦†ç›–æ‰€æœ‰æœªåˆ†é…ç©ºé—´ã€‚
2. é‡æ–°æ‰«æç‰©ç†å·æˆ–é‡å¯ç³»ç»Ÿï¼Œä½¿å†…æ ¸è¯†åˆ«æ–°çš„åˆ†åŒºå¤§å°ã€‚
3. æ‰©å±•ç‰©ç†å·ï¼ˆpvresizeï¼‰ã€‚
4. æ‰©å±•é€»è¾‘å·ï¼ˆlvextendï¼‰ã€‚
5. æ‰©å±•æ–‡ä»¶ç³»ç»Ÿï¼ˆxfs_growfsæˆ–resize2fsï¼‰ã€‚



éœ€è¦è¯¦ç»†è§£é‡Šæ¯ä¸ªæ­¥éª¤çš„å…·ä½“æ“ä½œå‘½ä»¤ï¼Œå¹¶æé†’ç”¨æˆ·è°¨æ…æ“ä½œï¼Œé¿å…æ•°æ®ä¸¢å¤±ã€‚



------

### **1. æ‰©å±• `/dev/sda2` åˆ†åŒº**

å½“å‰ `/dev/sda2` åˆ†åŒºä»…å ç”¨ 35GBï¼Œéœ€å…ˆå°†å…¶æ‰©å®¹ä»¥åˆ©ç”¨å‰©ä½™ç©ºé—´ã€‚

#### **æ­¥éª¤**ï¼š

1. å®‰è£… `parted` å·¥å…·ï¼ˆå¦‚æœªå®‰è£…ï¼‰ï¼š

   

   ```
   yum install -y parted
   ```

2. å¯åŠ¨ `parted`ï¼š

   

   ```
   parted /dev/sda
   ```

3. åœ¨ `parted` å‘½ä»¤è¡Œæ“ä½œï¼š

   

   ```
   (parted) print               # æŸ¥çœ‹åˆ†åŒºè¡¨
   (parted) resizepart 2        # é€‰æ‹©åˆ†åŒº2ï¼ˆå³sda2ï¼‰
   Warning: Partition is in use. Do you want to continue? Yes
   End?  [35GB]? 100%           # è¾“å…¥100%å°†åˆ†åŒºæ‰©å±•åˆ°ç£ç›˜æœ€å¤§å®¹é‡
   (parted) quit
   ```

4. é‡æ–°æ‰«æç£ç›˜åˆ†åŒºï¼š

   

   ```
   partprobe /dev/sda
   ```

------

### **2. æ‰©å±•ç‰©ç†å· (PV)**



```
pvresize /dev/sda2
```

#### **éªŒè¯**ï¼š



```
pvdisplay
```

è¾“å‡ºåº”æ˜¾ç¤º `/dev/sda2` çš„å®¹é‡å¢åŠ åˆ°çº¦ 230GBã€‚

------

### **3. æ‰©å±•é€»è¾‘å· (LV)**



```
lvextend -l +100%FREE /dev/centos/root
```

#### **éªŒè¯**ï¼š



```
lvdisplay
```

è¾“å‡ºåº”æ˜¾ç¤º `/dev/centos/root` çš„å®¹é‡å¢åŠ ã€‚

------

### **4. æ‰©å±•æ–‡ä»¶ç³»ç»Ÿ**

#### **ï¼ˆ1ï¼‰ç¡®è®¤æ–‡ä»¶ç³»ç»Ÿç±»å‹**ï¼š



```
df -Th /
```

å¦‚æœè¾“å‡ºæ˜¾ç¤º `xfs`ï¼ˆCentOS 7/8 é»˜è®¤ï¼‰ï¼Œæ‰§è¡Œï¼š



```
xfs_growfs /
```

#### **ï¼ˆ2ï¼‰æœ€ç»ˆéªŒè¯**ï¼š



```
df -h /
```

è¾“å‡ºåº”æ˜¾ç¤ºæ ¹åˆ†åŒºçš„å®¹é‡å·²æ‰©å±•ã€‚

------

### **å®Œæ•´æµç¨‹æ€»ç»“**



```
# 1. æ‰©å±•åˆ†åŒº
parted /dev/sda resizepart 2 100%
partprobe /dev/sda

# 2. æ‰©å±•ç‰©ç†å·
pvresize /dev/sda2

# 3. æ‰©å±•é€»è¾‘å·
lvextend -l +100%FREE /dev/centos/root

# 4. æ‰©å±•æ–‡ä»¶ç³»ç»Ÿ
xfs_growfs /          # XFS æ–‡ä»¶ç³»ç»Ÿ
# resize2fs /dev/centos/root  # ext4 æ–‡ä»¶ç³»ç»Ÿ
```

------

### **æ³¨æ„äº‹é¡¹**

1. **å¤‡ä»½æ•°æ®**ï¼šæ“ä½œå‰å»ºè®®å¤‡ä»½é‡è¦æ•°æ®ã€‚
2. **åˆ†åŒºå·¥å…·**ï¼šä½¿ç”¨ `parted` è€Œé `fdisk`ï¼Œå› åè€…å¯¹ GPT å’Œå¤§ç£ç›˜æ”¯æŒæœ‰é™ã€‚
3. **æ— éœ€é‡å¯**ï¼š`partprobe` ä¼šé€šçŸ¥å†…æ ¸åˆ†åŒºè¡¨å˜æ›´ï¼Œæ— éœ€é‡å¯ã€‚

------







